const r={PROD_PREFIX:"/apps/esquad-backend",DEV_URL:"http://localhost:3000",ENDPOINTS:{SIGNATURE:"/shopify/app-proxy/signature",CHAT:"/chat",TOKEN_STATUS:"/auth/token-status"}};class a{env;PROD_URL;constructor(){this.env=window.shopChatConfig?.env||"development",this.PROD_URL=window.shopChatConfig?.backendUrl}isProd(){return this.env==="production"}_toQueryString(t={}){if(!t||Object.keys(t).length===0)return"";const e={};for(const[n,o]of Object.entries(t))e[n]=String(o);return`?${new URLSearchParams(e).toString()}`}async _getProxyContext(t=""){const e=`${r.PROD_PREFIX}${r.ENDPOINTS.SIGNATURE}`,s=t?`${e}?${t}`:e,n=await fetch(s);if(!n.ok)throw new Error("Failed to retrieve Shopify app proxy context");const o=await n.json();return new URLSearchParams(o).toString()}async _buildUrl(t,e={},s=!0){const n=this._toQueryString(e);if(this.isProd())return`${r.PROD_PREFIX}${t}${n}`;const o=r.DEV_URL;if(s){const i=await this._getProxyContext(n.replace("?",""));return`${o}${t}?${i}`}return`${o}${t}${n}`}getBackendUrl(){return this.isProd()?r.PROD_PREFIX:r.DEV_URL}async getChatStreamUrl(){if(this.isProd()){const t=await this._getProxyContext();return`${this.PROD_URL}${r.ENDPOINTS.CHAT}?${t}`}return await this._buildUrl(r.ENDPOINTS.CHAT,{},!0)}async getChatHistoryUrl(t){const e={history:!0,conversation_id:t};return await this._buildUrl(r.ENDPOINTS.CHAT,e,!0)}async getTokenStatusUrl(t){return await this._buildUrl(r.ENDPOINTS.TOKEN_STATUS,{conversation_id:t},!1)}}window.shopChatUrlService=new a;
